#!/bin/bash

# Проверяем, что аргумент передан
if [ "$#" -ne 1 ]; then
    echo "Использование: $0 <процент заполнения (0-100)>"
    exit 1
fi

# Получаем процент заполнения
X=$1

# Проверяем, что переданное значение находится в диапазоне 0-100
if ! [[ "$X" =~ ^[0-9]+$ ]] || [ "$X" -lt 0 ] || [ "$X" -gt 100 ]; then
    echo "Ошибка: процент должен быть целым числом от 0 до 100."
    exit 1
fi

# Рассчитываем размер, который нужно заполнить в байтах
SIZE=$(( 500 * 1024 * 1024 * X / 100 ))

# Создаем директорию tmpfs с ограничением по памяти
MOUNT_POINT="/mnt/limited_memory_folder"

# Монтируем tmpfs с ограничением на 500 Мб
sudo mount -t tmpfs -o size=500M tmpfs $MOUNT_POINT

# Проверяем, удалось ли смонтировать
if [ $? -ne 0 ]; then
    echo "Ошибка: не удалось смонтировать tmpfs."
    exit 1
fi

# Переходим в смонтированную папку
cd $MOUNT_POINT

# Заполняем папку файлами до рассчитанного размера
echo "Заполнение папки до ${X}% (${SIZE} байт)..."

while [ $(du -sb . | awk '{print $1}') -lt $SIZE ]; do
    # Создаем временный файл размером 1 Мб
    head -c 1M </dev/urandom > temp_file_$RANDOM.bin
done

echo "Заполнение завершено."
